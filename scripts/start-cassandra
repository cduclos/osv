#!/bin/sh
#
CLASSPATH="/usr/cassandra/conf/:/usr/cassandra/apache-cassandra-1.2.6.jar:/usr/cassandra/apache-cassandra-clientutil-1.2.6.jar:/usr/cassandra/apache-cassandra-thrift-1.2.6.jar:/usr/cassandra/lib/antlr-3.2.jar:/usr/cassandra/lib/avro-1.4.0-fixes.jar:/usr/cassandra/lib/avro-1.4.0-sources-fixes.jar:/usr/cassandra/lib/commons-cli-1.1.jar:/usr/cassandra/lib/commons-codec-1.2.jar:/usr/cassandra/lib/commons-lang-2.6.jar:/usr/cassandra/lib/compress-lzf-0.8.4.jar:/usr/cassandra/lib/concurrentlinkedhashmap-lru-1.3.jar:/usr/cassandra/lib/guava-13.0.1.jar:/usr/cassandra/lib/high-scale-lib-1.1.2.jar:/usr/cassandra/lib/jackson-core-asl-1.9.2.jar:/usr/cassandra/lib/jackson-mapper-asl-1.9.2.jar:/usr/cassandra/lib/jamm-0.2.5.jar:/usr/cassandra/lib/jbcrypt-0.3m.jar:/usr/cassandra/lib/jline-1.0.jar:/usr/cassandra/lib/json-simple-1.1.jar:/usr/cassandra/lib/libthrift-0.7.0.jar:/usr/cassandra/lib/log4j-1.2.16.jar:/usr/cassandra/lib/lz4-1.1.0.jar:/usr/cassandra/lib/metrics-core-2.0.3.jar:/usr/cassandra/lib/netty-3.5.9.Final.jar:/usr/cassandra/lib/servlet-api-2.5-20081211.jar:/usr/cassandra/lib/slf4j-api-1.7.2.jar:/usr/cassandra/lib/slf4j-log4j12-1.7.2.jar:/usr/cassandra/lib/snakeyaml-1.6.jar:/usr/cassandra/lib/snappy-java-1.0.5.jar:/usr/cassandra/lib/snaptree-0.1.jar:/usr/cassandra/buildlib/*"

JAVAOPTS="$JAVAOPTS -javaagent:/usr/cassandra/lib/jamm-0.2.5.jar"
JAVAOPTS="$JAVAOPTS -XX:+UseThreadPriorities"
#JAVAOPTS="$JAVAOPTS -XX:ThreadPriorityPolicy=42"
JAVAOPTS="$JAVAOPTS -Xms1968M"
JAVAOPTS="$JAVAOPTS -Xmx1968M"
JAVAOPTS="$JAVAOPTS -Xmn400M"
JAVAOPTS="$JAVAOPTS -XX:+HeapDumpOnOutOfMemoryError"
JAVAOPTS="$JAVAOPTS -Xss180k"
JAVAOPTS="$JAVAOPTS -XX:+UseParNewGC"
JAVAOPTS="$JAVAOPTS -XX:+UseConcMarkSweepGC"
JAVAOPTS="$JAVAOPTS -XX:+CMSParallelRemarkEnabled"
JAVAOPTS="$JAVAOPTS -XX:SurvivorRatio=8"
JAVAOPTS="$JAVAOPTS -XX:MaxTenuringThreshold=1"
JAVAOPTS="$JAVAOPTS -XX:CMSInitiatingOccupancyFraction=75"
JAVAOPTS="$JAVAOPTS -XX:+UseCMSInitiatingOccupancyOnly"
JAVAOPTS="$JAVAOPTS -XX:+UseTLAB"
JAVAOPTS="$JAVAOPTS -XX:+UseCondCardMark"
JAVAOPTS="$JAVAOPTS -Djava.net.preferIPv4Stack=true"
JAVAOPTS="$JAVAOPTS -Djava.rmi.server.hostname=192.168.122.89"
JAVAOPTS="$JAVAOPTS -Dcom.sun.management.jmxremote"
JAVAOPTS="$JAVAOPTS -Dcom.sun.management.jmxremote.port=7199"
JAVAOPTS="$JAVAOPTS -Dcom.sun.management.jmxremote.ssl=false"
JAVAOPTS="$JAVAOPTS -Dcom.sun.management.jmxremote.authenticate=false"
JAVAOPTS="$JAVAOPTS -Dlog4j.configuration=log4j-server.properties"
JAVAOPTS="$JAVAOPTS -Dlog4j.defaultInitOverride=true"
JAVAOPTS="$JAVAOPTS -Dcassandra-foreground=yes"
JAVAOPTS="$JAVAOPTS -Djna.nounpack=true"
JAVAOPTS="$JAVAOPTS -Djna.debug_load=true"
JAVAOPTS="$JAVAOPTS -Djna.debug_load.jna=true"

OSVOPTS=$*

./scripts/run.py -nv -m4G -c4 $OSVOPTS -e "java.so $JAVAOPTS -cp /java/cloudius-1.0.jar:/java/cli-1.0.jar com.cloudius.cli.main.RhinoCLI java -classpath $CLASSPATH org.apache.cassandra.service.CassandraDaemon"
